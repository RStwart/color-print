<div class="row">

  <!-- Cards dos KPIs -->
  <div class="col-xl-4 col-md-6">
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Pedidos Finalizados</h5>
        <h4 class="card-text">{{ pedidosFinalizados }}</h4>
      </div>
    </div>
  </div>
  <div class="col-xl-4 col-md-6">
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Pedidos Pendentes</h5>
        <h4 class="card-text">{{ pedidosPendentes }}</h4>
      </div>
    </div>
  </div>
  <div class="col-xl-4 col-md-6">
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="card-title">Pedidos Cancelados</h5>
        <h4 class="card-text">{{ pedidosCancelados }}</h4>
      </div>
    </div>
  </div>

  <!-- Tabela Últimas Vendas -->
  <div class="col-xl-12 col-md-6">
    <div class="card mb-4">
      <div class="card-header">
        <h5 class="mb-0">Últimas Vendas</h5>
      </div>
      <div class="table-responsive">
        <table class="table table-hover mb-0">
          <thead>
            <tr>
              <th>Id Pedido</th>
              <th>Cliente</th>
              <th>Telefone</th>
              <th>Endereço</th>
              <th>CEP</th>
              <th>E-mail</th>
              <th>Item</th>
              <th>Valor</th>
              <th>Data</th>
              <th>Status</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let venda of vendasPaginadas">
              <td><h6 class="mb-1">{{ venda.id_pedido }}</h6></td>
              <td><p class="m-0">{{ venda.nome_cliente }}</p></td>
              <td><p class="m-0">{{ venda.telefone_cliente }}</p></td>
              <td><p class="m-0">{{ venda.endereco_cliente }}</p></td>
              <td><p class="m-0">{{ venda.cep_cliente }}</p></td>
              <td><p class="m-0">{{ venda.email_cliente }}</p></td>
              <td>
                <p class="m-0">
                  <ng-container *ngFor="let item of venda.itens_pedido; let last = last">
                    {{ item.nome }}
                    <span *ngIf="item.tamanho">({{ item.tamanho }})</span>
                    <span *ngIf="item.quantidade">({{ item.quantidade }})</span>
                    <span *ngIf="!last">, </span>
                  </ng-container>
                </p>
              </td>
              <td><p class="m-0">R$ {{ venda.valor | number:'1.2-2' }}</p></td>
              <td><p class="m-0">{{ venda.data_pedido | date:'dd/MM/yyyy' }}</p></td>
              <td>
                <h6 class="text-muted">
                  <i class="fas fa-circle"
                    [ngClass]="{
                      'text-success': venda.status_pedido === 'FINALIZADA',
                      'text-warning': venda.status_pedido === 'PENDENTE',
                      'text-danger': venda.status_pedido === 'CANCELADA'
                    }"></i>
                  {{ venda.status_pedido }}
                </h6>
              </td>
              <td>
                
                <button class="label theme-bg text-white f-12 rounded-pill" (click)="abrirModalAjuste(venda)">Ajustar</button>

                <span class="label bg-danger text-white f-12 rounded-pill" style="cursor:pointer">Remover</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      
      <!-- Paginação -->
      <div class="d-flex justify-content-center my-3">
        <nav>
          <ul class="pagination">
            <li class="page-item" [class.disabled]="paginaAtual === 1">
              <a class="page-link" (click)="paginaAnterior()" href="javascript:void(0)">Anterior</a>
            </li>
            <li class="page-item"
                *ngFor="let page of [].constructor(totalPaginas); let idx = index"
                [class.active]="paginaAtual === idx + 1">
              <a class="page-link" (click)="irParaPagina(idx + 1)" href="javascript:void(0)">{{ idx + 1 }}</a>
            </li>
            <li class="page-item" [class.disabled]="paginaAtual === totalPaginas">
              <a class="page-link" (click)="proximaPagina()" href="javascript:void(0)">Próximo</a>
            </li>
          </ul>
        </nav>
      </div>

    </div>
  </div>



  <!-- Modal de Ajuste de Pedido -->
  <div class="modal fade show" tabindex="-1" [ngStyle]="{display: mostrarModalAjuste ? 'block' : 'none'}" style="background: rgba(0,0,0,0.3);" *ngIf="pedidoSelecionado">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title">Ajustar Pedido #{{pedidoSelecionado.id_pedido}}</h5>
          <button type="button" class="btn-close" (click)="fecharModalAjuste()"></button>
        </div>

        <div class="modal-body">
          <div class="mb-3">
            <label>Status do Pedido:</label>
            <select class="form-select" [(ngModel)]="pedidoSelecionado.status_pedido">
              <option value="PENDENTE">PENDENTE</option>
              <option value="FINALIZADA">FINALIZADA</option>
              <option value="CANCELADA">CANCELADA</option>
            </select>
          </div>
          
          <h6>Itens do Pedido:</h6>
          <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between align-items-center" *ngFor="let item of pedidoSelecionado.itens_pedido">
              <span>
                {{ item.nome }}
                <span *ngIf="item.tamanho">({{ item.tamanho }})</span>
                <span *ngIf="item.quantidade"> x{{ item.quantidade }}</span>
              </span>
              <span>R$ {{ item.preco }}</span>
            </li>
          </ul>
        </div>

        <div class="modal-footer">
          <button class="btn btn-primary" (click)="salvarStatusPedido()">Salvar</button>
          <button class="btn btn-secondary" (click)="fecharModalAjuste()">Fechar</button>
        </div>

      </div>
    </div>
  </div>


</div>
